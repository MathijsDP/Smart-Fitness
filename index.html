<!DOCTYPE html>
<html>
<head>
    <title>Fitness App Project</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #eee; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 20px; max-width: 400px; margin: auto; }
        button { background: #28a745; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; font-size: 18px; }
        #getal { font-size: 80px; color: blue; font-weight: bold; }
        canvas { width: 100%; border-radius: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h1>Fitness Coach AI</h1>

    <div id="vragenlijst">
        <p>Wat gaan we doen?</p>
        <select id="welkeOefening" style="width:100%; padding:10px; margin-bottom:10px;">
            <option value="squat">Squats (Benen)</option>
            <option value="pushup">Push-ups (Borst)</option>
        </select>

        <p>Hoeveel reps is je doel?</p>
        <select id="hoeveelReps" style="width:100%; padding:10px; margin-bottom:20px;">
            <option value="5">Beginner (5)</option>
            <option value="10">Gemiddeld (10)</option>
            <option value="20">Expert (20)</option>
        </select>

        <button onclick="start()">START TRAINING</button>
    </div>

    <div id="sportveld" style="display:none;">
        <h2 id="titel">Bezig...</h2>
        <div id="getal">0</div>
        <p id="boodschap">Camera wordt geladen...</p>
        <canvas id="canvas"></canvas>
    </div>
</div>

<script>
    // --- STAP 1: PLAK HIER JE LINKS ---
    const SQUAT_LINK = "https://teachablemachine.withgoogle.com/models/h7p-JBDaq/"; 
    const PUSHUP_LINK = "https://teachablemachine.withgoogle.com/models/nUrbOTVH6/"; 

    // --- STAP 2: DE VARIABELEN (Dingen die we moeten onthouden) ---
    let model, webcam, ctx, teller = 0, status = "omhoog", doel = 0;

    // --- STAP 3: DE START FUNCTIE ---
    async function start() {
        // Welke oefening is gekozen?
        const keuze = document.getElementById("welkeOefening").value;
        doel = document.getElementById("hoeveelReps").value;

        // Kies de juiste link
        let deLink = (keuze === "squat") ? SQUAT_LINK : PUSHUP_LINK;
        document.getElementById("titel").innerText = keuze.toUpperCase();

        // Wissel scherm
        document.getElementById("vragenlijst").style.display = "none";
        document.getElementById("sportveld").style.display = "block";

        // Laad AI en Camera
        model = await tmPose.load(deLink + "model.json", deLink + "metadata.json");
        webcam = new tmPose.Webcam(300, 300, true);
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loop);

        const canvas = document.getElementById("canvas");
        canvas.width = 300; canvas.height = 300;
        ctx = canvas.getContext("2d");
        document.getElementById("boodschap").innerText = "Succes! Ga voor de " + doel + " reps.";
    }

    async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
    }

    // --- STAP 4: DE TELLER (HET MOEILIJKSTE DEEL) ---
    async function predict() {
        const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
        const voorspelling = await model.predict(posenetOutput);

        // voorspelling[0] = omhoog, voorspelling[1] = omlaag
        
        // Ben je nu omlaag? (Meer dan 90% zeker)
        if (voorspelling[1].probability > 0.90) {
            status = "omlaag";
        }

        // Ben je weer omhoog EN was je hiervoor omlaag?
        if (voorspelling[0].probability > 0.90 && status === "omlaag") {
            status = "omhoog"; // Reset de status
            teller++;         // Tel er 1 bij op
            document.getElementById("getal").innerText = teller;

            if (teller >= doel) {
                alert("Gefeliciteerd! Je hebt je doel bereikt.");
                location.reload(); // Start de app opnieuw
            }
        }
        ctx.drawImage(webcam.canvas, 0, 0);
    }
</script>

</body>
</html>