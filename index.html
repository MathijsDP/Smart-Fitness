<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartFitness AI | Elite Coach</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #000; --surface: #121212; --accent: #fff; --sub: #8e8e93; --blue: #007aff; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--accent); overflow: hidden; height: 100vh; }
        .screen { height: 100vh; display: flex; flex-direction: column; padding: 40px 25px; box-sizing: border-box; overflow-y: auto; }
        .hidden { display: none !important; }
        
        h1 { font-family: 'Montserrat'; font-size: 28px; font-weight: 900; letter-spacing: -1px; margin: 0; }
        .subtitle { color: var(--sub); font-size: 12px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 25px; }
        
        .card { background: var(--surface); border-radius: 16px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .btn { background: var(--accent); color: var(--bg); border: none; padding: 18px; border-radius: 12px; width: 100%; font-weight: 800; text-transform: uppercase; cursor: pointer; }
        .btn-outline { background: transparent; border: 1px solid #333; color: white; padding: 18px; border-radius: 12px; margin: 5px 0; width: 100%; text-align: left; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; }
        
        /* Workout UI */
        .workout-ui { position: relative; flex: 1; border-radius: 24px; overflow: hidden; background: #000; }
        canvas { width: 100%; height: 100%; object-fit: cover; }
        .hud { position: absolute; top: 0; width: 100%; padding: 20px; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); display: flex; justify-content: space-between; }
        .hud-item { text-align: center; }
        .hud-item span { display: block; font-size: 10px; color: var(--sub); font-weight: 800; }
        .hud-item strong { font-size: 20px; font-family: 'Montserrat'; }

        #rest-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .timer { font-size: 70px; font-family: 'Montserrat'; font-weight: 900; color: var(--blue); }

        /* Nav */
        .nav { position: fixed; bottom: 0; width: 100%; background: rgba(18,18,18,0.9); backdrop-filter: blur(15px); display: flex; justify-content: space-around; padding: 20px 0 35px; border-top: 1px solid #222; }
        .nav-item { color: var(--sub); font-size: 10px; font-weight: 700; text-transform: uppercase; cursor: pointer; }
        .nav-item.active { color: #fff; }
    </style>
</head>
<body>

    <div id="screen-home" class="screen">
        <h1>JOURNEY</h1>
        <div class="subtitle" id="date-today">VANDAAG</div>
        
        <div class="card" style="border: 1px solid var(--blue);">
            <h2 style="margin:0 0 10px 0;">Elite Training</h2>
            <p style="color:var(--sub); font-size:14px; margin-bottom:20px;">Start een gepersonaliseerde sessie op basis van je doelen.</p>
            <button class="btn" onclick="openChoice()">START WORKOUT</button>
        </div>
    </div>

    <div id="screen-choice" class="screen hidden">
        <h1>DOELSTELLING</h1>
        <div class="subtitle">Wat wil je bereiken?</div>
        <button class="btn-outline" onclick="setGoal('Spieren')">SPIEROPBOUW <span>ðŸ’ª</span></button>
        <button class="btn-outline" onclick="setGoal('Conditie')">CONDITIE <span>ðŸ”¥</span></button>
        
        <h1 style="margin-top:40px">FOCUS</h1>
        <div class="subtitle">Welke zone?</div>
        <button class="btn-outline" onclick="startFullSession('Upper')">UPPER BODY <span>ðŸ‘•</span></button>
        <button class="btn-outline" onclick="startFullSession('Lower')">LOWER BODY <span>ðŸ©³</span></button>
        <button class="btn" style="margin-top:20px; background:#1c1c1e; color:white;" onclick="nav('home')">TERUG</button>
    </div>

    <div id="screen-workout" class="screen hidden" style="padding:0">
        <div class="workout-ui">
            <video id="input_video" style="display:none"></video>
            <canvas id="output_canvas"></canvas>
            
            <div id="rest-screen" class="hidden">
                <div class="subtitle">VOLGENDE: <span id="next-exe-name">---</span></div>
                <div class="timer" id="timer-val">15</div>
            </div>

            <div class="hud">
                <div class="hud-item"><span>OEFENING</span><strong id="exe-display">---</strong></div>
                <div class="hud-item"><span>REPS</span><strong id="rep-display">0/12</strong></div>
            </div>
            
            <div id="coach-hint" style="position:absolute; bottom:30px; width:100%; text-align:center; font-size:12px; font-weight:800; color:var(--blue);">LAAD AI MOTOR...</div>
        </div>
        <div style="padding:20px; background:#000;"><button class="btn" style="background:#1c1c1e; color:white" onclick="location.reload()">STOP</button></div>
    </div>

    <div id="screen-stats" class="screen hidden">
        <h1>BODY STATUS</h1>
        <div class="subtitle">Spierspanning & Progressie</div>
        <div class="card" style="text-align:center;">
             <div id="body-lvl" style="font-size:12px; display:flex; justify-content:space-around;">
                <div>UPPER: <strong id="lvl-up">1</strong></div>
                <div>LOWER: <strong id="lvl-low">1</strong></div>
                <div>CORE: <strong id="lvl-core">1</strong></div>
             </div>
        </div>
    </div>

    <nav class="nav hidden" id="navbar">
        <div class="nav-item active" onclick="nav('home', this)">Coach</div>
        <div class="nav-item" onclick="nav('stats', this)">Body</div>
        <div class="nav-item" onclick="location.reload()">Reset</div>
    </nav>

    <script>
        const exercises = {
            Upper: ["Push-up", "Incline push-up", "Pike push-up", "Diamond push-up", "Chair dips", "Superman", "Bird dog", "Plank shoulder taps", "Towel curl", "Isometric bicep hold"],
            Lower: ["Bodyweight squat", "Forward lunge", "Glute bridge", "Donkey kicks"],
            Conditie: ["Jumping jacks", "High knees", "Mountain climbers", "Burpees", "Plank", "Dead bug"]
        };

        let currentPlaylist = [];
        let currentIndex = 0;
        let db = JSON.parse(localStorage.getItem('eliteFit')) || { xpUpper: 0, xpLower: 0, xpCore: 0, goal: '' };
        let reps = 0, isRest = false, stage = 'up';

        function nav(s, el) {
            document.querySelectorAll('.screen').forEach(x => x.classList.add('hidden'));
            document.getElementById('screen-'+s).classList.remove('hidden');
            document.getElementById('navbar').classList.remove('hidden');
            if(el) { document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); el.classList.add('active'); }
            if(s === 'stats') {
                document.getElementById('lvl-up').innerText = Math.floor(db.xpUpper/50)+1;
                document.getElementById('lvl-low').innerText = Math.floor(db.xpLower/50)+1;
                document.getElementById('lvl-core').innerText = Math.floor(db.xpCore/50)+1;
            }
        }

        function openChoice() { nav('choice'); }
        function setGoal(g) { db.goal = g; alert("Doel ingesteld: " + g); }

        function startFullSession(focus) {
            currentPlaylist = [];
            // Mix de oefeningen
            if(db.goal === 'Conditie') {
                currentPlaylist = [...exercises.Conditie];
            } else {
                currentPlaylist = [...exercises[focus]];
            }
            
            currentIndex = 0;
            nav('workout');
            initAI();
            startCurrentExe();
        }

        function startCurrentExe() {
            reps = 0;
            document.getElementById('exe-display').innerText = currentPlaylist[currentIndex].toUpperCase();
            document.getElementById('rep-display').innerText = "0/12";
            const s = new SpeechSynthesisUtterance("Volgende oefening: " + currentPlaylist[currentIndex]);
            s.lang='nl-NL'; window.speechSynthesis.speak(s);
        }

        // AI Pose Logic
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');

        function onResults(results) {
            if (!results.poseLandmarks || isRest) return;
            canvasCtx.save();
            canvasCtx.clearRect(0,0, canvasElement.width, canvasElement.height);
            canvasCtx.drawImage(results.image, 0,0, canvasElement.width, canvasElement.height);
            drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#fff', lineWidth: 2});
            
            const m = results.poseLandmarks;
            const exe = currentPlaylist[currentIndex];

            // Vereenvoudigde logica voor demo (Squat/Pushup/Jacks)
            if(exe.includes("squat") || exe.includes("lunge")) {
                const a = calcAngle(m[24], m[26], m[28]);
                if(a < 110) stage = 'down';
                if(a > 160 && stage === 'down') { countRep(); stage = 'up'; }
            } else if(exe.includes("push-up") || exe.includes("dips")) {
                const a = calcAngle(m[11], m[13], m[15]);
                if(a < 100) stage = 'down';
                if(a > 150 && stage === 'down') { countRep(); stage = 'up'; }
            } else {
                // Cardio/Static logic
                if(m[15].y < m[11].y) stage = 'up';
                if(m[15].y > m[11].y && stage === 'up') { countRep(); stage = 'down'; }
            }
            canvasCtx.restore();
        }

        function countRep() {
            reps++;
            document.getElementById('rep-display').innerText = reps + "/12";
            const s = new SpeechSynthesisUtterance(reps); s.lang='nl-NL'; window.speechSynthesis.speak(s);
            
            // XP toewijzen
            const focus = currentPlaylist[currentIndex];
            if(exercises.Upper.includes(focus)) db.xpUpper += 5;
            else if(exercises.Lower.includes(focus)) db.xpLower += 5;
            else db.xpCore += 5;
            localStorage.setItem('eliteFit', JSON.stringify(db));

            if(reps >= 12) {
                currentIndex++;
                if(currentIndex < currentPlaylist.length) startRest();
                else { alert("Workout Voltooid!"); location.reload(); }
            }
        }

        function startRest() {
            isRest = true;
            document.getElementById('rest-screen').classList.remove('hidden');
            document.getElementById('next-exe-name').innerText = currentPlaylist[currentIndex].toUpperCase();
            let t = 15;
            let iv = setInterval(() => {
                t--; document.getElementById('timer-val').innerText = t;
                if(t <= 0) { clearInterval(iv); isRest = false; document.getElementById('rest-screen').classList.add('hidden'); startCurrentExe(); }
            }, 1000);
        }

        function calcAngle(a, b, c) {
            const r = Math.atan2(c.y-b.y, c.x-b.x) - Math.atan2(a.y-b.y, a.x-b.x);
            let ang = Math.abs(r*180/Math.PI);
            return ang > 180 ? 360-ang : ang;
        }

        function initAI() {
            const pose = new Pose({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`});
            pose.setOptions({ modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
            pose.onResults(onResults);
            const cam = new Camera(videoElement, { onFrame: async () => {
                canvasElement.width = videoElement.videoWidth; canvasElement.height = videoElement.videoHeight;
                await pose.send({image: videoElement});
            }, width: 640, height: 480 });
            cam.start();
        }

        document.getElementById('date-today').innerText = new Date().toLocaleDateString('nl-NL', {weekday:'long', day:'numeric', month:'short'}).toUpperCase();
        nav('home');
    </script>
</body>
</html>
