<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Elite Smart Coach v11</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE VISUALS --- */
        :root {
            --bg: #09090b;
            --card: #18181b;
            --primary: #a855f7; /* Purple Neon */
            --accent: #22d3ee;  /* Cyan Neon */
            --success: #4ade80;
            --text: #ffffff;
            --sub: #a1a1aa;
            --radius: 20px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text);
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
        }

        /* --- SCREEN MANAGEMENT --- */
        .screen {
            position: absolute; inset: 0; padding: 20px 20px 100px;
            display: flex; flex-direction: column; overflow-y: auto;
            opacity: 0; pointer-events: none; transform: scale(0.95); transition: 0.4s ease;
            background: linear-gradient(to bottom, #09090b 0%, #000 100%);
        }
        .screen.active { opacity: 1; pointer-events: auto; transform: scale(1); z-index: 10; }

        /* --- TYPOGRAPHY --- */
        h1 { font-family: 'Oswald', sans-serif; font-size: 28px; margin: 0; text-transform: uppercase; letter-spacing: 1px; }
        .subtitle { color: var(--sub); font-size: 13px; margin-bottom: 20px; }
        .section-header { font-size: 12px; font-weight: 700; color: var(--sub); text-transform: uppercase; margin-top: 25px; margin-bottom: 10px; letter-spacing: 1px; }

        /* --- UI COMPONENTS --- */
        .card {
            background: var(--card); border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius); padding: 20px; margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4); position: relative; overflow: hidden;
            transition: transform 0.2s;
        }
        .card:active { transform: scale(0.98); }

        .btn {
            background: linear-gradient(135deg, var(--primary), #7c3aed); color: #fff;
            border: none; padding: 18px; border-radius: 16px; width: 100%;
            font-weight: 700; font-family: 'Oswald'; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4); cursor: pointer; margin-top: 10px;
        }
        
        .badge-grid { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .badge { 
            min-width: 80px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; 
            text-align: center; border: 1px solid rgba(255,255,255,0.1); opacity: 0.5; filter: grayscale(1);
        }
        .badge.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--accent); background: rgba(34, 211, 238, 0.1); }
        .badge-icon { font-size: 24px; display: block; margin-bottom: 5px; }
        
        /* --- DASHBOARD ELEMENTS --- */
        .fit-score {
            display: flex; align-items: center; justify-content: space-between;
            background: linear-gradient(90deg, rgba(168, 85, 247, 0.2), transparent);
            padding: 15px; border-radius: 16px; border-left: 4px solid var(--primary);
        }
        
        /* Stats Bars */
        .stat-bar { height: 6px; background: #333; border-radius: 3px; margin-top: 8px; overflow: hidden; }
        .stat-fill { height: 100%; background: var(--accent); transition: width 1s ease; }

        /* --- WORKOUT & CAMERA --- */
        #scr-workout { padding: 0; background: #000; }
        #output_canvas { width: 100%; height: 100%; object-fit: contain; transform: scaleX(-1); }
        
        .hud-overlay {
            position: absolute; inset: 0; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent 15%, transparent 85%, rgba(0,0,0,0.9));
            padding: 40px 20px;
        }

        .rep-counter { font-size: 80px; font-family: 'Oswald'; font-weight: 700; text-align: center; color: #fff; text-shadow: 0 0 20px var(--primary); }
        .feedback-flash { position: absolute; inset: 0; background: rgba(74, 222, 128, 0.3); opacity: 0; transition: opacity 0.1s; pointer-events: none; }

        /* --- NAVIGATION --- */
        .navbar {
            position: fixed; bottom: 20px; left: 20px; right: 20px;
            background: rgba(24, 24, 27, 0.9); backdrop-filter: blur(10px);
            border-radius: 25px; padding: 15px; display: flex; justify-content: space-around;
            border: 1px solid rgba(255,255,255,0.1); z-index: 100;
        }
        .nav-item { color: #555; font-size: 22px; transition: 0.3s; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); text-shadow: 0 0 10px rgba(168,85,247,0.5); }

        /* Rest Overlay */
        #rest-overlay { position: absolute; inset: 0; background: rgba(9,9,11,0.95); z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .timer-circle { width: 140px; height: 140px; border-radius: 50%; border: 6px solid #333; border-top-color: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 50px; font-family: 'Oswald'; margin: 20px 0; animation: spin 2s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Inputs */
        input, select { width: 100%; padding: 16px; background: #27272a; border: 1px solid #3f3f46; color: white; border-radius: 12px; margin-bottom: 12px; font-size: 16px; }
    </style>
</head>
<body>

    <div id="scr-onboarding" class="screen active">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center;">
            <div style="font-size:60px; margin-bottom:10px;">ü§ñ</div>
            <h1>Elite AI Coach</h1>
            <p class="subtitle">Laten we je profiel bouwen voor maximale resultaten.</p>
            <div id="q-area"></div>
        </div>
    </div>

    <div id="scr-dash" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <h1 id="user-greet">HELLO</h1>
                <div class="subtitle" id="date-display">...</div>
            </div>
            <div onclick="shareApp()" style="background:#27272a; padding:8px 15px; border-radius:20px; font-size:12px; font-weight:700;">
                üî• <span id="streak-disp">0</span>
            </div>
        </div>

        <div class="fit-score" onclick="nav('stats', document.getElementById('nav-stats'))">
            <div>
                <div style="font-size:10px; font-weight:700; color:var(--primary);">FIT SCORE</div>
                <div style="font-size:24px; font-weight:800;" id="fit-score-val">0</div>
            </div>
            <div style="text-align:right;">
                <div style="font-size:10px; color:#aaa;">FOCUS VANDAAG</div>
                <div style="font-weight:700; color:#fff;" id="smart-focus">Borst</div>
            </div>
        </div>

        <div class="section-header">START TRAINING</div>
        
        <div class="card" onclick="startRecommended()" style="border-color:var(--primary); background: linear-gradient(45deg, rgba(168,85,247,0.1), transparent);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="background:var(--primary); color:#000; font-size:9px; font-weight:800; padding:3px 8px; border-radius:4px; display:inline-block; margin-bottom:5px;">AI AANBEVOLEN</div>
                    <h3 style="margin:0;" id="rec-title">UPPER BODY</h3>
                    <div style="font-size:11px; color:#aaa; margin-top:4px;">Gebaseerd op je Fit Score</div>
                </div>
                <div style="font-size:30px;">üéØ</div>
            </div>
        </div>

        <div class="card" onclick="startCircuit('Upper')">
            <strong>Upper Body</strong> <span style="color:#666; font-size:12px;">‚Ä¢ Kracht & Volume</span>
        </div>
        <div class="card" onclick="startCircuit('Lower')">
            <strong>Lower Body</strong> <span style="color:#666; font-size:12px;">‚Ä¢ Benen & Billen</span>
        </div>
        
        <div class="section-header">PRESTATIES DEZE WEEK</div>
        <div class="card" style="height:100px; display:flex; align-items:flex-end; gap:5px; padding-top:40px;" id="week-chart">
            </div>
    </div>

    <div id="scr-stats" class="screen">
        <h1>Jouw Progressie</h1>
        <div class="subtitle">Badges & Spiergroepen</div>

        <div class="section-header">BADGES</div>
        <div class="badge-grid" id="badge-area">
            </div>

        <div class="section-header">SPIERGROEP LEVELS</div>
        <div id="stats-list"></div>
    </div>

    <div id="scr-workout" class="screen">
        <video id="input_video" style="display:none"></video>
        <canvas id="output_canvas"></canvas>
        <div class="feedback-flash" id="flash"></div>

        <div class="hud-overlay">
            <div style="display:flex; justify-content:space-between;">
                <div>
                    <div style="font-size:10px; font-weight:700; color:#aaa;">OEFENING</div>
                    <div style="font-size:20px; font-weight:700; font-family:'Oswald';" id="hud-ex-name">SQUAT</div>
                </div>
                <div>
                    <div style="font-size:10px; font-weight:700; color:#aaa; text-align:right;">SET</div>
                    <div style="font-size:20px; font-weight:700; font-family:'Oswald'; text-align:right;" id="hud-set">1/3</div>
                </div>
            </div>

            <div style="text-align:center;">
                <div class="rep-counter" id="hud-reps">0</div>
                <div style="color:var(--success); font-weight:700; font-size:14px; opacity:0; transition:0.3s;" id="hud-feedback">GOED!</div>
            </div>

            <button onclick="stopWorkout()" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:#fff; padding:10px; border-radius:20px; font-size:12px; margin:0 auto; display:block;">STOP SESSIE</button>
        </div>

        <div id="rest-overlay" class="hidden">
            <h1 id="rest-title">RUST</h1>
            <div class="subtitle">Volgende: <span id="next-ex-name" style="color:var(--accent); font-weight:bold;">...</span></div>
            <div class="timer-circle" id="timer-val">30</div>
            <p id="rest-tip" style="color:#aaa; font-size:13px; max-width:250px; text-align:center;">Haal diep adem en maak je klaar.</p>
            <button class="btn" onclick="skipRest()">START NU</button>
        </div>
    </div>

    <div id="scr-finish" class="screen">
        <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;">
            <div style="font-size:60px;">üèÜ</div>
            <h1>WORKOUT COMPLETE</h1>
            <p class="subtitle">Je bent een stap dichter bij je doel.</p>
            
            <div class="card" style="width:100%; text-align:left;">
                <div style="font-size:12px; color:#aaa;">SAMENVATTING</div>
                <div style="font-size:24px; font-weight:700; color:var(--text);" id="fin-total-reps">0 REPS</div>
                <div style="font-size:14px; color:var(--primary);" id="fin-xp">+150 XP verdiend</div>
            </div>

            <button class="btn" onclick="shareResult()">DEEL RESULTAAT üì§</button>
            <button class="btn" style="background:#333; margin-top:10px;" onclick="nav('dash', document.getElementById('nav-dash'))">TERUG NAAR DASHBOARD</button>
        </div>
    </div>

    <nav class="navbar hidden" id="nav">
        <div class="nav-item active" id="nav-dash" onclick="nav('dash', this)">üè†</div>
        <div class="nav-item" id="nav-stats" onclick="nav('stats', this)">üìä</div>
    </nav>

    <script>
        // --- DATA & CONFIG ---
        const exercises = {
            Upper: [
                {n:"Push-up", tip:"Borst naar de grond, rug recht.", mus:["Borst","Triceps"]},
                {n:"Shoulder Taps", tip:"Tik om en om je schouders aan.", mus:["Schouders","Abs"]},
                {n:"Pike Push-up", tip:"Duw je billen omhoog in een V.", mus:["Schouders"]},
                {n:"Diamond Push-up", tip:"Handen in een diamant vorm.", mus:["Triceps"]},
                {n:"Superman", tip:"Til armen en benen tegelijk op.", mus:["Rug"]}
            ],
            Lower: [
                {n:"Squat", tip:"Zak diep, knie√´n naar buiten.", mus:["Benen","Billen"]},
                {n:"Lunge", tip:"Achterste knie net boven de grond.", mus:["Benen"]},
                {n:"Glute Bridge", tip:"Duw je heupen explosief omhoog.", mus:["Billen"]},
                {n:"Calf Raise", tip:"Op je tenen en even vasthouden.", mus:["Kuiten"]},
                {n:"High Knees", tip:"Knie√´n hoog, tempo maken!", mus:["Conditie"]}
            ]
        };

        const badgesList = [
            {id:'first', icon:'ü•á', title:'Eerste Stap', cond: u => u.totalWorkouts >= 1},
            {id:'streak3', icon:'üî•', title:'On Fire', cond: u => u.streak >= 3},
            {id:'reps100', icon:'ü§ñ', title:'Rep Machine', cond: u => u.totalReps >= 100},
            {id:'early', icon:'üåÖ', title:'Vroege Vogel', cond: u => new Date().getHours() < 9 && u.totalWorkouts > 0}
        ];

        let user = JSON.parse(localStorage.getItem('elite_ai_v11')) || {
            name: '', goal: '', xp: {}, totalReps: 0, totalWorkouts: 0, streak: 0, lastDate: null, history: [], badges: []
        };
        
        // Init XP if empty
        ['Borst','Rug','Benen','Billen','Schouders','Triceps','Abs','Conditie','Kuiten'].forEach(m => {
            if(!user.xp[m]) user.xp[m] = {lvl:1, val:0};
        });

        // Runtime State
        let activeC = [], cIdx=0, set=1, reps=0, stage='up', isRest=false, timer=null;
        let camera, pose;

        // --- INIT ---
        if(!user.name) initOnboarding();
        else { nav('dash', document.getElementById('nav-dash')); updateDash(); }

        // --- ONBOARDING ---
        function initOnboarding() {
            const qArea = document.getElementById('q-area');
            let step = 0;
            const qs = [
                {t:'Wat is je voornaam?', k:'name', type:'text'},
                {t:'Wat is je hoofddoel?', k:'goal', type:'select', opts:['Sterker worden', 'Afvallen', 'Atletisch']},
            ];

            function showQ() {
                if(step >= qs.length) { 
                    localStorage.setItem('elite_ai_v11', JSON.stringify(user)); 
                    nav('dash', document.getElementById('nav-dash')); updateDash();
                    return; 
                }
                const q = qs[step];
                let html = `<label>${q.t}</label>`;
                if(q.type=='text') html += `<input id="inp" type="text">`;
                else html += `<select id="inp">${q.opts.map(o=>`<option>${o}</option>`)}</select>`;
                html += `<button class="btn" onclick="saveA()">VOLGENDE</button>`;
                qArea.innerHTML = html;
            }
            window.saveA = () => {
                user[qs[step].k] = document.getElementById('inp').value;
                step++; showQ();
            };
            showQ();
        }

        // --- DASHBOARD LOGIC ---
        function updateDash() {
            document.getElementById('user-greet').innerText = `HEY ${user.name.toUpperCase()}`;
            document.getElementById('date-display').innerText = new Date().toLocaleDateString('nl-NL', {weekday:'long', day:'numeric', month:'long'});
            
            // Streak Logic
            const today = new Date().toDateString();
            if(user.lastDate !== today) {
                const y = new Date(); y.setDate(y.getDate()-1);
                if(user.lastDate === y.toDateString()) { /* streak continues */ }
                else if(user.lastDate !== today) { user.streak = (user.streak > 0 && user.lastDate === today) ? user.streak : 0; }
            }
            document.getElementById('streak-disp').innerText = user.streak;

            // Fit Score & Smart Rec
            let totalLvl = 0, lowest = {n:'Upper', v:999};
            Object.keys(user.xp).forEach(k => {
                totalLvl += user.xp[k].lvl;
                if(user.xp[k].lvl < lowest.v) lowest = {n:k, v:user.xp[k].lvl};
            });
            const score = Math.min(100, Math.floor((totalLvl / 9) * 10) + user.totalWorkouts);
            document.getElementById('fit-score-val').innerText = score;
            
            // Smart Focus Logic
            let recCat = 'Upper';
            if(['Benen','Billen','Kuiten'].includes(lowest.n)) recCat = 'Lower';
            document.getElementById('smart-focus').innerText = recCat === 'Upper' ? 'Upper Body' : 'Lower Body';
            document.getElementById('rec-title').innerText = recCat.toUpperCase();
            window.recommendedCat = recCat;

            // Chart (Simple CSS bars)
            const ch = document.getElementById('week-chart');
            ch.innerHTML = user.history.slice(-7).map(h => {
                const hgt = Math.min(100, h.reps * 0.5); // scale
                return `<div style="flex:1; background:#333; border-radius:4px; display:flex; align-items:flex-end;"><div style="width:100%; background:var(--accent); height:${hgt}%; border-radius:4px;"></div></div>`;
            }).join('');
        }

        function startRecommended() { startCircuit(window.recommendedCat); }

        // --- WORKOUT ENGINE ---
        function startCircuit(cat) {
            activeC = [...exercises[cat]].sort(()=>0.5-Math.random());
            cIdx=0; set=1; reps=0;
            document.getElementById('nav').classList.add('hidden');
            document.querySelector('.screen.active').classList.remove('active');
            document.getElementById('scr-workout').classList.add('active');
            
            startCamera();
            startRest(10, "KLAARSTAAN");
        }

        function startRest(sec, title) {
            isRest = true;
            document.getElementById('rest-overlay').classList.remove('hidden');
            document.getElementById('rest-title').innerText = title || "RUST";
            document.getElementById('next-ex-name').innerText = activeC[cIdx].n;
            document.getElementById('rest-tip').innerText = activeC[cIdx].tip;
            
            let t = sec;
            document.getElementById('timer-val').innerText = t;
            if(timer) clearInterval(timer);
            timer = setInterval(() => {
                t--; document.getElementById('timer-val').innerText = t;
                if(t<=0) skipRest();
            }, 1000);
        }

        function skipRest() {
            clearInterval(timer); isRest = false;
            document.getElementById('rest-overlay').classList.add('hidden');
            speak(`Start ${activeC[cIdx].n}`);
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('hud-ex-name').innerText = activeC[cIdx].n.toUpperCase();
            document.getElementById('hud-set').innerText = `${set}/3`;
            document.getElementById('hud-reps').innerText = reps;
        }

        function flashFeedback() {
            const f = document.getElementById('flash');
            f.style.opacity = 1;
            setTimeout(()=>f.style.opacity=0, 150);
            const txt = document.getElementById('hud-feedback');
            txt.style.opacity = 1;
            setTimeout(()=>txt.style.opacity=0, 800);
        }

        // --- AI VISION ---
        function onPose(res) {
            if(!res.poseLandmarks || isRest) return;
            const ctx = document.getElementById('output_canvas').getContext('2d');
            ctx.clearRect(0,0, ctx.canvas.width, ctx.canvas.height);
            ctx.drawImage(res.image, 0,0, ctx.canvas.width, ctx.canvas.height);
            
            const lm = res.poseLandmarks;
            const ex = activeC[cIdx].n.toLowerCase();
            let good = false;

            // Simple Logic for Demo
            if(ex.includes('squat') || ex.includes('lunge')) {
                const ang = calcAngle(lm[24], lm[26], lm[28]);
                if(ang < 120) { stage='down'; good=true; }
                if(ang > 160 && stage=='down') { countRep(); stage='up'; }
            } else {
                if(lm[12].y > lm[24].y - 0.1) { stage='down'; good=true; }
                else if(stage=='down') { countRep(); stage='up'; }
            }
            
            drawConnectors(ctx, lm, POSE_CONNECTIONS, {color: good?'#4ade80':'#a855f7', lineWidth:4});
        }

        function countRep() {
            reps++; user.totalReps++;
            updateHUD(); flashFeedback(); speak(reps);
            
            // Give XP
            activeC[cIdx].mus.forEach(m => {
                user.xp[m].val += 10;
                if(user.xp[m].val >= user.xp[m].lvl * 100) {
                    user.xp[m].val=0; user.xp[m].lvl++;
                    speak(`${m} Level Up`);
                }
            });

            if(reps >= 10) { // Demo: 10 reps per set
                if(set < 3) { set++; reps=0; startRest(30, "EINDE SET"); }
                else {
                    cIdx++;
                    if(cIdx < activeC.length) { set=1; reps=0; startRest(45, "VOLGENDE OEFENING"); }
                    else { finishWorkout(); }
                }
            }
        }

        function finishWorkout() {
            stopWorkout();
            user.totalWorkouts++;
            user.lastDate = new Date().toDateString();
            user.history.push({date: new Date(), reps: user.totalReps}); // Log history
            checkBadges();
            localStorage.setItem('elite_ai_v11', JSON.stringify(user));

            document.getElementById('scr-finish').classList.add('active');
            document.getElementById('nav').classList.remove('hidden');
            document.getElementById('fin-total-reps').innerText = `${user.totalReps} TOTAL REPS`;
            
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            speak("Gefeliciteerd. Training voltooid.");
        }

        function stopWorkout() {
            isRest = false; clearInterval(timer);
            if(camera) camera.stop();
            document.getElementById('scr-workout').classList.remove('active');
        }

        // --- GAMIFICATION ---
        function checkBadges() {
            badgesList.forEach(b => {
                if(!user.badges.includes(b.id) && b.cond(user)) {
                    user.badges.push(b.id);
                    // Badge toast could go here
                }
            });
        }

        function renderStats() {
            // Badges
            const bArea = document.getElementById('badge-area');
            bArea.innerHTML = badgesList.map(b => `
                <div class="badge ${user.badges.includes(b.id)?'unlocked':''}">
                    <span class="badge-icon">${b.icon}</span>
                    <div style="font-size:10px; font-weight:700;">${b.title}</div>
                </div>
            `).join('');

            // Levels
            const lArea = document.getElementById('stats-list');
            lArea.innerHTML = Object.keys(user.xp).map(k => {
                const x = user.xp[k];
                const pct = (x.val / (x.lvl*100))*100;
                return `
                <div class="card" style="padding:15px; margin-bottom:10px;">
                    <div style="display:flex; justify-content:space-between; font-size:12px; font-weight:700;">
                        <span>${k}</span> <span>LVL ${x.lvl}</span>
                    </div>
                    <div class="stat-bar"><div class="stat-fill" style="width:${pct}%"></div></div>
                </div>`;
            }).join('');
        }

        function shareResult() {
            const txt = `üöÄ Elite AI Coach\nIk heb net getraind!\nüî• Streak: ${user.streak}\nüí™ Totaal Reps: ${user.totalReps}\nLevel: ${document.getElementById('fit-score-val').innerText}/100`;
            navigator.clipboard.writeText(txt).then(() => alert("Tekst gekopieerd! Deel het op social media."));
        }

        // --- UTILS ---
        function nav(scr, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('scr-'+scr).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(el) el.classList.add('active');
            if(scr === 'stats') renderStats();
            if(scr === 'dash') updateDash();
        }
        function speak(t) { window.speechSynthesis.speak(new SpeechSynthesisUtterance(t)); }
        function startCamera() {
            const v = document.getElementById('input_video');
            const c = document.getElementById('output_canvas');
            pose = new Pose({locateFile:(f)=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${f}`});
            pose.setOptions({modelComplexity:1, smoothLandmarks:true});
            pose.onResults(onPose);
            camera = new Camera(v, {onFrame:async()=>{c.width=v.videoWidth;c.height=v.videoHeight;await pose.send({image:v})}});
            camera.start();
        }
        function calcAngle(a,b,c){const r=Math.atan2(c.y-b.y,c.x-b.x)-Math.atan2(a.y-b.y,a.x-b.x);let d=Math.abs(r*180/Math.PI);return d>180?360-d:d;}

    </script>
</body>
</html>
