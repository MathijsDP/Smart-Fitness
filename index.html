<!DOCTYPE html>
<html>
<head>
    <title>School Project Fitness</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
</head>
<body style="font-family:sans-serif; text-align:center;">
    <h1>Mijn Fitness App</h1>
    <div id="setup">
        <button style="padding:20px;" onclick="init()">START CAMERA</button>
    </div>
    <div id="training">
        <h2 style="font-size:40px;">Reps: <span id="count">0</span></h2>
        <canvas id="canvas"></canvas>
        <div id="status">Laden...</div>
    </div>

<script>
    // PLAK HIER JE LINK VAN TEACHABLE MACHINE
    const URL = "https://teachablemachine.withgoogle.com/models/h7p-JBDaq/";

    let model, webcam, ctx, count = 0, status = "omhoog";

    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        model = await tmPose.load(modelURL, metadataURL);
        
        webcam = new tmPose.Webcam(300, 300, true); 
        await webcam.setup();
        await webcam.play();
        window.requestAnimationFrame(loop);

        const canvas = document.getElementById("canvas");
        canvas.width = 300; canvas.height = 300;
        ctx = canvas.getContext("2d");
        document.getElementById("status").innerText = "Succes! Begin met trainen.";
    }

    async function loop() {
        webcam.update();
        await predict();
        window.requestAnimationFrame(loop);
    }

    async function predict() {
        const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
        const prediction = await model.predict(posenetOutput);

        // Als je omlaag gaat (Klasse 1)
        if (prediction[1].probability > 0.90) {
            status = "omlaag";
        }
        // Als je weer omhoog komt (Klasse 0)
        if (prediction[0].probability > 0.90 && status === "omlaag") {
            status = "omhoog";
            count++;
            document.getElementById("count").innerText = count;
        }
        ctx.drawImage(webcam.canvas, 0, 0);
    }
</script>
</body>
</html>